---
title: "ST 558 Project 1"
author: "Rebecca Voelker"
date: "10/05/2021"
---

This document will walk the reader through the process of connecting to & collecting data from the COVID API within R.  

##### __Render Code (for Reference ONLY)__

```{r, Render, eval=FALSE}
rmarkdown::render("ST_558_Project_1.Rmd", "github_document","README.md")
```

#### __Packages Required for Vignette__

The below packages are required for connecting to the API, as well as the subsequent data analysis and exploration performed on the data retrieved from the API.  

1. `httr` - _Retrieves Data from API_
2. `jsonlite` - _Parses Results from API Query_
3. `dplyr` - _A part of the `tidyverse` universe of packages, specifically for used manipulating data_

```{r libraries, message=FALSE}

library(httr)
library(jsonlite)
library(dplyr)
```

#### __COVID API Function Calls__

Below are 6 functions I have created to call various endpoints of the [COVID-19 API Data](https://documenter.getpostman.com/view/10808728/SzS8rjbc#e831c268-9da1-4d86-8b5a-8d7f61910af8).

Note that for each function created, I have performed a test of the functional call, outputting the object as *functionname*_Test. 

##### `CountryFun`

This function call, calls in a user-specified country and it's  slug-code

```{r function1}

CountryFun <- function(country){
  base <- "https://api.covid19api.com/live/country/"
  endpoint <- country
  paste <- paste(base, endpoint, sep = "")
  outputAPI <- fromJSON(paste)
  return(as_tibble(outputAPI))
}

CountryFun_Test <- CountryFun("australia")
```

##### `CountryCOVIDFun`

This function call, calls in the details of COVID cases in a user-specified country. Details include the Total Number of Confirmed COVID Cases, the Total Number of Recoveries, and the Total Number of Deaths. 

```{r function2}
CountryCOVIDFun <- function(country){
  API_init <- GET("https://api.covid19api.com/summary")
  API_content <- content(API_init, as = "text")
  API_JSON <- fromJSON(API_content)
  output <- API_JSON$Countries %>% select(ID:TotalRecovered) %>% filter(Country == country)
}

CountryCVOIDFun_Test <- CountryCOVIDFun("South Africa") 
```

##### `CountryConfirmFun`

This function call, calls in the details of COVID cases in a user-specified country, *by province/state*. Details include the Total Number of Confirmed COVID Cases, the Total Number of Recoveries, and the Total Number of Deaths.
 User can also specify if they would like to look at the data, as-of a specific # of Confirmed Cases.
 
```{r function3}
CountryConfirmFun <- function(x, y){
  base <- "https://api.covid19api.com/live/country/"
  endpoint <- x
  paste_url <- paste(base, endpoint, sep = "")
  API_init <- GET(paste_url)
  API_content <- content(API_init, as = "text")
  API_JSON <- fromJSON(API_content)
  output <- API_JSON %>% filter(Confirmed >= y)
  return(output)
}

CountryConfirmFun_Test <- CountryConfirmFun("australia", 5000)

```

##### `USCOVIDFun`

This function call, calls the details of COVID cases in a particular state in the United States. Details include the Total Number of Confirmed COVID Cases, the Total Number of Recoveries, and the Total Number of Deaths.

```{r function4}

USCOVIDFun <- function(province){
  API_init <- GET("https://api.covid19api.com/live/country/USA")
  API_content <- content(API_init, as = "text")
  API_JSON <- fromJSON(API_content)
  output <- API_JSON %>% filter(Province == province)
  return(output)
}

USCOVIDFun_Test <- USCOVIDFun("Wisconsin")
```

##### `USConfirmFun`

This function call, calls the details of the first instance, per state, of COVID cases greater than (or equal to) a user-specified # of cases. Details include the State Name, Latitude & Longitude of the State, Total Number of Recovers, and the Total Number of Deaths and the date the # of Confirmed Cases first hit >= the User-Specified value.

```{r function5}
USConfirmFun <- function(x){
  API_init <- GET("https://api.covid19api.com/live/country/USA")
  API_content <- content(API_init, as = "text")
  API_JSON <- fromJSON(API_content)
  output <- API_JSON %>% filter(Confirmed >= x) %>% arrange(Province, Confirmed)
  output_subset <- output[match(unique(output$Province), output$Province),]
  return(output_subset)
}

USConfirmFun_Test <- USConfirmFun(100000)
```

##### `USDeathFun`

This function call, calls the details of the first instance, per state, of COVID deaths greater than (or equal to) a user-specified # of deaths. Details include the State Name, Latitude & Longitude of the State, Total Number of Recovers, and the Total Number of Deaths and the date the # of deaths first hit >= the User-Specified value.

```{r function6}
USDeathFun <-function(x){
  API_init <- GET("https://api.covid19api.com/live/country/USA")
  API_content <- content(API_init, as = "text")
  API_JSON <- fromJSON(API_content)
  output <- API_JSON %>% filter(Deaths >= x) %>% arrange(Province, Deaths)
  output_subset <- output[match(unique(output$Province), output$Province),]
  return(output_subset)
}

USDeathFun_Test <- USDeathFun(5000)
```

#### __Exploratory Data Analysis__