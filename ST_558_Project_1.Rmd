---
title: "ST 558 Project 1"
author: "Rebecca Voelker"
date: "10/05/2021"
---

This document will walk the reader through the process of connecting to & collecting data from the COVID API within R.  

##### __Render Code (for Reference ONLY)__

```{r, Render, eval=FALSE}
rmarkdown::render("ST_558_Project_1.Rmd", "github_document","README.md")
```

#### __Packages Required for Vignette__

The below packages are required for connecting to the API, as well as the subsequent data analysis and exploration performed on the data retrieved from the API.  

1. `httr` - _Retrieves Data from API_
2. `jsonlite` - _Parses Results from API Query_
3. `dplyr` - _A part of the `tidyverse` universe of packages, specifically for used manipulating data_

```{r libraries, message=FALSE}

library(httr)
library(jsonlite)
library(dplyr)
```

#### __COVID API Function Calls__

Below are 6 functions I have created to call various endpoints of the [COVID-19 API Data](https://documenter.getpostman.com/view/10808728/SzS8rjbc#e831c268-9da1-4d86-8b5a-8d7f61910af8).

Note that for each function created, I have performed a test of the functional call, outputting the object as *functionname*_Test. 

##### `CountryFun`

This function call, calls in a user-specified country and it's  slug-code

```{r function1}

CountryFun <- function(country){
  base <- "https://api.covid19api.com/live/country/"
  endpoint <- country
  paste <- paste(base, endpoint, sep = "")
  outputAPI <- fromJSON(paste)
  return(as_tibble(outputAPI))
}

CountryFun_Test <- CountryFun("australia")
```

## This function will call the details of COVID cases in in particular country

```{r function2}
funCountry <- function(country){
  API_init <- GET("https://api.covid19api.com/summary")
  API_content <- content(API_init, as = "text")
  API_JSON <- fromJSON(API_content)
  output <- API_JSON$Countries %>% select(ID:TotalRecovered) %>% filter(Country == country)
}

SATest <- funCountry("South Africa") 
```

## This function will call the details of Confirmed Cases that are >= X (User-Defined) # of Cases in Australia 

```{r function3}
funAUS_Confirm <- function(x){
  API_init <- GET("https://api.covid19api.com/live/country/australia")
  API_content <- content(API_init, as = "text")
  API_JSON <- fromJSON(API_content)
  output <- API_JSON %>% filter(Confirmed >= x)
  return(output)
}

AUSConfirmTest <- funAUS_Confirm(50000)

```

## This function will call the details of COVID cases in a particular state in the United States

```{r function4}

funState <- function(province){
  API_init <- GET("https://api.covid19api.com/live/country/USA")
  API_content <- content(API_init, as = "text")
  API_JSON <- fromJSON(API_content)
  output <- API_JSON %>% filter(Province == province)
  return(output)
}

WISTest <- funState("Wisconsin")
```

## This function will call the details of the first instance of COVID cases >= X (User-Defined) # of Confirmed Cases in any state in the United States

```{r function5}
funUS_Confirm <- function(x){
  API_init <- GET("https://api.covid19api.com/live/country/USA")
  API_content <- content(API_init, as = "text")
  API_JSON <- fromJSON(API_content)
  output <- API_JSON %>% filter(Confirmed >= x) %>% arrange(Province, Confirmed)
  output_subset <- output[match(unique(output$Province), output$Province),]
  return(output_subset)
}

ConfirmTest <- funUS_Confirm(100000)
```

## This function will call the details of the first instance of Deaths >= X (User-Defined) # in any state in the United States

```{r function6}
funUS_Death <-function(x){
  API_init <- GET("https://api.covid19api.com/live/country/USA")
  API_content <- content(API_init, as = "text")
  API_JSON <- fromJSON(API_content)
  output <- API_JSON %>% filter(Deaths >= x) %>% arrange(Province, Deaths)
  output_subset <- output[match(unique(output$Province), output$Province),]
  return(output_subset)
}

funUS_DeathTest <- funUS_Death(5000)
```